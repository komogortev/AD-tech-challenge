/*! appdirect 2017-05-22 */

Store={isAvailable:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}},dataEncode:function(e){return JSON.stringify(e)},dataDecode:function(e){try{e=JSON.parse(e)}catch(t){e=null}return e},set:function(e,t,i){if(Store.isAvailable)return localStorage.setItem(e,Store.dataEncode({type:i||"settings",data:t}))},get:function(e){if(Store.isAvailable){var t=Store.dataDecode(localStorage.getItem(e));return null!==t&&t.hasOwnProperty("data")?t.data:null}},reset:function(e){if(Store.isAvailable)return localStorage.removeItem(e)}},Store.readSettings=function(e){return Store.get(e)},Store.writeSettings=function(e,t){return Store.set(e,t)},Core={params:{storageSettingsKey:"pageSettings",pageSettingsCollection:""},init:function(){"use strict";Core.params.pageSettingsCollection=Store.readSettings(Core.params.storageSettingsKey),Core.initSettings(),Core.listenSettings(),Core.handleDrag(),Core.handleToggle()}},Core.handleDrag=function(){var e;$(document).on("dragstart",function(t){$(".js-drop-box").addClass("drag-on"),e=t.target,$(e).addClass("in-transit")}),$(document).bind("dragover",function(e){e.preventDefault()}),$(document).on("drop",function(t){t.preventDefault(),$(".js-drop-box").removeClass("drag-on"),$(e).removeClass("in-transit");var i=$(e).closest(".js-drop-box"),r=$(t.target).closest(".js-drop-box"),n=$(t.target).closest(".js-drop-box").find(".js-drag-box");i.remove(".js-drag-box").append(n),r.remove(".js-drag-box").append(e)})},Core.handleToggle=function(){$(".js-toggle").off("click").on("click",function(){var e=$($(this).data("target"));e.hasClass("is-active")?e.removeClass("is-active"):e.addClass("is-active")})},Core.sortUsers=function(e){var t=$(".user-feed").find(".js-drop-box");switch(e){case"order-asc":t.each(function(e){$(this).css("order",e+1)});break;case"order-desc":t.each(function(e){$(this).css("order",t.length-e),console.log(t.length-e)});break;case"order-mix":for(var i,r=[i=1];i<t.length;r[i++]=parseInt(Math.random()*i));t.each(function(e){$(this).css("order",r[e])});break;default:return!1}},Core.resetSettings=function(){new Promise(function(e,t){e(Store.reset(Core.params.storageSettingsKey))}).then(function(){location.reload()})},Core.switchClassTrigger=function(e,t){var i="(^|\\s)"+e+"\\S+",r=new RegExp(i,"g");$("body")[0].className=$("body")[0].className.replace(r,""),$("body").addClass(t)},Core.updateClassCollection=function(e){var t=e.split("-")[0];if(void 0!==e){switch(t){case"order":Core.sortUsers(e);break;case"theme":$('link[rel=stylesheet][href*="'+t+'"]').remove(),$("<link/>",{rel:"stylesheet",href:"stylesheets/"+e+".css"}).appendTo("head");break;case"reset":return Core.resetSettings(),!1}Core.switchClassTrigger(t,e),Core.params.pageSettingsCollection=$("body")[0].className,Store.writeSettings(Core.params.storageSettingsKey,Core.params.pageSettingsCollection)}},Core.listenSettings=function(){$(".js-settings").off("click").on("click.layoutSwitch",function(){Core.updateClassCollection($(this).data("option"))})},Core.initSettings=function(){$("body").addClass(Core.params.pageSettingsCollection)},Core.init(),Filter={types:[".js-date-filter",".js-amount-filter"],params:{storageSettingsKey:"filterSettings",filterSettingsCollection:{filterId:"start"}},init:function(){"use strict";Filter.params.filterSettingsCollection=null===Store.readSettings(Filter.params.storageSettingsKey)?{}:Store.readSettings(Filter.params.storageSettingsKey),Filter.initFilters()},dateOptions:{year:"numeric",month:"short",day:"numeric"},timeOptions:{hour:"numeric",minute:"numeric"},timestamp:function(e){return new Date(e).getTime()}},Filter.findStoredFilter=function(e){return null!==Filter.params.filterSettingsCollection[e]&&Filter.params.filterSettingsCollection[e]},Filter.updateFilterCollection=function(e,t){void 0!==e&&(Filter.params.filterSettingsCollection[e]=t,Store.writeSettings(Filter.params.storageSettingsKey,Filter.params.filterSettingsCollection))},Filter.bildOptions=function(e){var t={},i=$(e).attr("id"),r=Filter.findStoredFilter(i);if(t.step=1,"date"===e.data("type")){var n=Filter.timestamp($(e).closest("ol.tweets-feed").find("li.tweet-box").first().find("time").data("original")),o=Filter.timestamp($(e).closest("ol.tweets-feed").find("li.tweet-box").last().find("time").data("original"));t.type="date",t.start=r||[o,n],t.connect=!0,t.format=wNumb({decimals:0}),t.step=(n-o)/10,t.range={min:o,max:n}}else t.type="amount",t.start=r?parseFloat(r):100,t.connect=[!0,!1],t.tooltips=wNumb({decimals:0}),t.range={min:0,max:$(e).closest("ol.tweets-feed").find("li.tweet-box").length};return{elemId:i,options:t}},Filter.signTooltip=function(e,t){var i=$("#"+e).closest("ol.tweets-feed").find(".js-"+t.type+"-tooltip"),r="date"==t.type?Filter.normalizeDate(t.start[0])+" - "+Filter.normalizeDate(t.start[1]):t.start;i.html(r)},Filter.create=function(e,t){var i=document.getElementById(e);noUiSlider.create(i,t).on("set.sliderFilter",function(e,t){Filter.handleChange(this,e,t)}),i.noUiSlider.set(t.start)},Filter.findInstances=function(e){return $(e)},Filter.initFilter=function(e){Filter.findInstances(e).each(function(){Promise.resolve(Filter.bildOptions($(this))).then(function(e){Filter.create(e.elemId,e.options),Filter.signTooltip(e.elemId,e.options)}).catch(function(e){console.log(e)})})},Filter.initFilters=function(){Array.from(Filter.types).forEach(function(e){Filter.initFilter(e)})},Filter.normalizeDate=function(e){var t=new Date(parseInt(e)).toLocaleString("en-US",Filter.dateOptions).replace(/([a-zA-Z]+) (\d{1,2}\,)/,"$2 $1").replace(",","");return new Date(parseInt(e)).toLocaleString("en-US",Filter.timeOptions)+", "+t},Filter.updateFeedView=function(e,t){e.find("li.tweet-box").show(),e.find(t).hide()},Filter.findLimitsIndex=function(e,t){var i=t[0],r=t[1],n=null,o=null;return $(e).children(".tweet-box").each(function(e){if(null===n&&$(this).data("ms-range")<i&&(n=e),null===o&&$(this).data("ms-range")<r&&(o=e),null!==o&&null!==n)return!1}),"li.tweet-box:nth-child(-n+"+o+"):nth-child(n+"+n+")"},Filter.handleChange=function(e,t,i){var r,n,o=void 0===t[i]?t:t[i],a=$(e.target).data("type"),s=$(e.target).closest("ol.tweets-feed"),l=s.find(".js-"+a+"-tooltip"),c=parseFloat(o),d="li.tweet-box:nth-child(n+"+(c+2)+"):visible";"date"===a&&(r=Filter.normalizeDate(t[0]),n=Filter.normalizeDate(t[1])),Filter.updateFeedView(s,d),Filter.updateFilterCollection($(e.target).attr("id"),t),$(l).html("date"===a?r+" - "+n:c)},Filter.init();